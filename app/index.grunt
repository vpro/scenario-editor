<!doctype html>
<html ng-app="SE" ng-controller="MainController as mainCtrl" ng-init="mainCtrl.init()">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Scenario Editor</title>

    <link rel="icon"
          type="image/png"
          href="img/vpro.ico">

	<!-- build:css styles/app.css -->
	<link rel="stylesheet" href="styles/main.css" type="text/css" media="all" />
    <link rel="stylesheet" href="styles/twitter-bootstrap/bootstrap.min.css" type="text/css" media="all" />
    <link rel="stylesheet" href="styles/style.css"/>
	<!-- endbuild -->

</head>

<body>

	<div class="container-fluid">

        <div class="row">

            <div class="col-md-8 col-md-push-2">

                <div ng-if="scenarios" id="scenario-selector">
                    <h2 class="h6">Select a scenario</h2>
                    <!-- Op de een of andere manier komt ng-model niet op de scope, dus ik geef hem hier
                        maar door aan de activateScenario method welke vervolgens het scenario inlaadt
                        en de naam van het scenario als scope.activeScenario set.

                        TODO: fix this as described in http://stackoverflow.com/a/22768720
                     -->
                    <select class="form-control" ng-model="selectedScenario" ng-change="mainCtrl.activateScenario( selectedScenario )">
                        <option value="">Select...</option>
                        <option ng-repeat="scenario in scenarios" value="{{scenario}}" ng-selected="scenario == selectedScenario">{{scenario}}</option>
                    </select>

                </div>

            </div>

        </div>
        
        <!-- Maar even ter test de scenario selector hierboven ingezet voordat onderstaande zichtbaar is, kies eerst een scenario :) -->
        <div class="scenario-editor" ng-class="{'hidden': ! activeScenario }">
        
            <div class="row bg-info" id="display" ng-class="{'closed': ! playerVisible}">

                <div class="col-md-12" id="player">
    
                    <div id="scenario-player-container">
                        <se-player id="scenario-player"></se-player>
                    </div>
    
                </div>
    
            </div>
            <div class="row scenario-editor-controls bg-info">
                <div class="col-md-10 col-md-push-2">
                    <div class="btn-group">
                        <button class="btn btn-primary" ng-click="mainCtrl.previewScenario()">preview scenario</button>

                        <button ng-show="!playerVisible" class="btn btn-primary" ng-click="mainCtrl.togglePlayerVisible()">show player</button>
                        <button ng-show="playerVisible" class="btn btn-primary" ng-click="mainCtrl.togglePlayerVisible()">hide player</button>

                        <button ng-show="!audioActorsVisible" class="btn btn-primary" ng-click="mainCtrl.toggleAudioActorsVisible()">show audio actors</button>
                        <button ng-show="audioActorsVisible" class="btn btn-primary" ng-click="mainCtrl.toggleAudioActorsVisible()">hide audio actors</button>

                        <button class="btn btn-primary" ng-click="mainCtrl.saveScenario()">save scenario</button>
                    </div>
                </div>
            </div>


            <div class="row scenario-editor-controls">
                <div class="col-md-10 col-md-push-2">
                    <div class="meta">
                        <label for="script-name">Titel</label>
                        <input id="script-name" type="text" ng-model="script.name" />
                    </div>
                    <div class="meta">
                        <label for="script-duration">Duur</label>
                        <input id="script-duration" ng-model="script.duration" type="number" />
                    </div>
                </div>
            </div>

            <div class="row scenario-editor-controls">

                <div class="col-md-2">
                    <div class="form-inline">
                        <select class="form-control" ng-model="selectedActor" ng-options="actor as actor.name for actor in actorTypes"></select>

                        <button class="btn-default btn" ng-class="{'disabled': !selectedActor}" ng-click="mainCtrl.addActor( selectedActor )">add {{selectedActor.name}}</button>
                    </div>

                </div>

                <div class="col-md-10">
                    <button class="btn btn-default" ng-click="mainCtrl.sortActors()">
                        <span>sort on starttime</span> <span class="glyphicon glyphicon-arrow-down"></span>
                    </button>
                </div>
            </div>


            <div class="timeline">
    
                <div class="row se-actor actor-{{actor.type}}"
                     ng-repeat="actor in actors track by $index"
                     ng-hide="actor.type === 'audio' && !audioActorsVisible">

                    <div>

                        <div class="col-md-2">

                            <div>
                                <input class="actor-edit-title" type="text"
                                       ng-model="actor.title">
                            </div>

                            <div>
                                <label for="actor-start-{{$index}}">start </label>
                                <input id="actor-start-{{$index}}" type="number" step="1000"
                                       ng-model="actor.start"/>
                            </div>

                            <div>
                                <label for="actor-duration-{{$index}}">duur  </label>
                                <input id="actor-duration-{{$index}}" type="number" step="1000"
                                       ng-model="actor.duration" />
                            </div>

                            <div ng-if="actor.src">
                                <label for="actor-src-{{$index}}">src</label>
                                <input class="actor-edit-src" id="actor-src-{{$index}}"
                                       ng-focus="mainCtrl.openAssetSelector( $event )"
                                       ng-model="actor.src" />
                            </div>

                            <div>
                                <label for="actor-animation-{{$index}}">animation </label>
                                <select id="actor-animation-{{$index}}"
                                        ng-model="actor.animationName"
                                        ng-options="animationName as animationName for animationName in animationNames">
                                    <option value=""></option>
                                </select>
                            </div>

                            <div ng-if="actor.trigger">

                                <label>trigger</label>

                                <div class="sub-option">
                                    <label for="actor-trigger-active-{{$index}}">active</label>
                                    <input type="checkbox" id="actor-trigger-active-{{$index}}"
                                           ng-model="actor.trigger.active">
                                </div>

                                <div ng-if="actor.trigger.active" class="sub-option">
                                    <label for="actor-trigger-type-{{$index}}">AV type</label>

                                    <select id="actor-trigger-type-{{$index}}"
                                            ng-model="actor.trigger.type">
                                        <option value="audio">audio</option>
                                        <option value="video">video</option>
                                    </select>
                                </div>

                                <div ng-if="actor.trigger.active" class="sub-option">
                                    <label for="actor-trigger-event-{{$index}}">event</label>

                                    <select id="actor-trigger-event-{{$index}}"
                                            ng-model="actor.trigger.event">
                                        <option value="click">click</option>
                                    </select>
                                </div>

                                <div ng-if="actor.trigger.active" class="sub-option">
                                    <label for="actor-trigger-src-{{$index}}">src</label>

                                    <input id="actor-trigger-src-{{$index}}"
                                           class="actor-edit-src"
                                           ng-model="actor.trigger.src"
                                           ng-focus="mainCtrl.openAssetSelector( $event )">
                                    </input>
                                </div>

                            </div>

                        </div>



                        <div class="col-md-10">

                            <div class="row">

                                <div class="col-md-4">

                                    <div class="actor-src">

                                        <div class="value">

                                            <span ng-if="actor.name.length">{{actor.name}}</span>

                                            <span ng-if="actor.src.length > 0"
                                                  ng-class="{'actor-src-preview': (actor.type == 'generic' || actor.type == 'ambi')}">
                                                - {{actor.src}}
                                            </span>

                                            <div class="actor-thumb" style="background-image: url('{{assetRoot}}{{actor.src}}')"
                                                 ng-if="actor.type == 'generic' || actor.type == 'ambi'">
                                            </div>

                                        </div>

                                    </div>

                                </div>


                            </div>

                            <div se-draggable-container class="actor-timeline">
                                <div class="actor-timeline-title">{{actor.title}}</div>
                                <span se-draggable ondrag="mainCtrl.onDrag(actor, x, y)" ondrop="mainCtrl.onDrop()" class="indicator" ng-style="{
                                    left:(actor.start/script.duration)*100+'%',
                                    width:(actor.duration/script.duration)*100+'%'
                                }"></span>
                            </div>

                            <div class="actor-delete"
                                    ng-click="mainCtrl.deleteActor( $index )">
                                <span class="glyphicon glyphicon-remove-sign"></span>
                            </div>

                        </div>

                    </div>
    
                </div>
    
            </div>
        </div>
	</div>



    <div id="asset-selector">

        <div class="asset-selector-close" ng-click="mainCtrl.closeAssetSelector()">
            <span class="glyphicon glyphicon-remove-circle"></span>
        </div>

        <div ng-repeat="(key, value) in availableAssets | groupBy: 'type'">

            <div class="asset-group asset-group-{{key}}">
                <div class="asset-group-title">{{ key }}</div>

                <div ng-repeat="asset in value">

                    <div class="asset-preview asset-img" ng-show="asset.path.indexOf('img/') !== -1" ng-click="mainCtrl.selectAsset( asset.path )">
                        <div class="asset-img-thumb" style="background-image: url({{assetRoot}}{{asset.path}})"></div>
                    </div>

                    <div class="asset-preview asset-audio" ng-show="asset.path.indexOf('audio/') !== -1" ng-click="mainCtrl.selectAsset( asset.path )">
                        {{asset.path}}
                    </div>

                    <div class="asset-preview asset-video" ng-show="asset.path.indexOf('video/') !== -1" ng-click="mainCtrl.selectAsset( asset.path )">
                        {{asset.path}}
                    </div>

                </div>

            </div>

        </div>

    </div>





    <script src="<%- jsserver %>/embed/configuration.js?var=vpro"></script>
    <script src="<%- jsserver %>/ext/require/2.1.17/require.min.js"></script>

	<!-- build:js js/vendor.js -->
	<script src="scripts/vendor/angularjs/angular.min.js"></script>
    <script src="scripts/vendor/angular-filter.min.js"></script>
	<!-- endbuild -->

	<!-- build:js js/editor.js -->
	<script src="scripts/editor/app.js"></script>
	<script src="scripts/editor/constants.js"></script>
	<script src="scripts/editor/controllers/MainController.js"></script>

	<script src="scripts/editor/services/ScenarioService.js"></script>
	<script src="scripts/editor/services/ActorService.js"></script>

	<script src="scripts/editor/directives/Draggable.js"></script>
	<script src="scripts/editor/directives/ScenarioPlayer.js"></script>

	<!-- endbuild -->

</body>
</html>